<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Indus Boys Hostel - Fee Receipt Generator</title>

<link rel="icon" type="image/png" href="https://i.postimg.cc/7CFG4hRp/hostel-logo.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: #f8fafc;
  color: #0f172a;
}
.app-container {
  max-width: 600px;
  margin: auto;
  padding: 20px;
}
.header {
  text-align: center;
  margin-bottom: 20px;
}
.header img {
  height: 60px;
}
.header h1 {
  margin: 10px 0 5px;
  font-size: 1.6rem;
}
.header h2 {
  margin: 0;
  color: #0ea5e9;
  font-weight: 600;
}
input {
  width: 100%;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #cbd5e1;
  margin-top: 8px;
  font-size: 1rem;
}
.btn {
  background: #0ea5e9;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  margin-top: 10px;
}
.btn:hover { background: #0284c7; }

/* --- PDF Styling --- */
#receiptForPdf {
  position: fixed;
  left: -9999px;
  top: -9999px;
  width: 210mm;
  background: #fff;
  padding: 20mm;
  color: #000;
  font-family: 'Poppins', sans-serif;
  font-size: 12pt;
  box-sizing: content-box;
  position: relative;
  overflow: hidden;
}

.watermark {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) rotate(-30deg);
  font-size: 80pt;
  color: rgba(0, 0, 0, 0.06);
  font-weight: 700;
  user-select: none;
  pointer-events: none;
  z-index: 0;
  letter-spacing: 8px;
}

.section-title {
  font-weight: 700;
  font-size: 13pt;
  color: #0f172a;
  border-bottom: 2px solid #0ea5e9;
  margin-top: 20px;
  margin-bottom: 8px;
  padding-bottom: 4px;
  position: relative;
  z-index: 1;
}
.row {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  border-bottom: 1px dotted #cbd5e1;
  position: relative;
  z-index: 1;
}
.row:last-child { border-bottom: none; }
.pdf-footer {
  text-align: center;
  font-size: 9pt;
  color: #64748b;
  margin-top: 40px;
  position: relative;
  z-index: 1;
}
.signature-area {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  margin-top: 50px;
  position: relative;
  z-index: 1;
}
.signature-box {
  text-align: center;
}
.signature-box img {
  max-height: 60px;
}
.stamp-box img {
  max-height: 80px;
  opacity: 0.9;
}
.stamp-slogan {
  font-size: 9pt;
  color: #475569;
  margin-top: 5px;
}
</style>
</head>

<body>
<div class="app-container">
  <div class="header">
    <img src="https://i.postimg.cc/7CFG4hRp/hostel-logo.png" alt="Logo">
    <h1>The Indus Boys Hostel Services, Sukkur</h1>
    <h2>Fee Receipt Generator</h2>
  </div>

  <label>Resident Name or Roll No:</label>
  <input type="text" id="searchName" placeholder="e.g. Awais Mahar or 20K-1001">
  <div id="searchResult"></div>
</div>

<div id="receiptForPdf"></div>

<script>
const HOSTEL_LOGO_URL = "https://i.postimg.cc/7CFG4hRp/hostel-logo.png";
const ADMIN_SIGNATURE_URL = "";
const ADMIN_STAMP_URL = "https://i.postimg.cc/vZztLrMQ/Red-and-White-Minimalist-Christmas-Circle-Sticker-removebg-preview.png"; // Replace with your real stamp
const MANAGEMENT_PHONE = "0313-7352949";
const MANAGEMENT_EMAIL = "indusboyshostelsuk@gmail.com";

const studentsList = [
  {
    name: "Awais Mahar",
    roll: "20K-1001",
    room: "1 SF",
    fee: 1,
    receiptNo: "IBH-10001",
    paymentMethod: "Bank Transfer",
    recipient: "Faiq Ali",
    logoUrl: HOSTEL_LOGO_URL,
    signatureUrl: "https://i.postimg.cc/K8QD0JZb/IMG-20251006-WA0028-removebg-preview.png",
    stampUrl: ADMIN_STAMP_URL
  },
  {
    name: "Ali Zaib",
    roll: "20K-1002",
    room: "1 SF",
    fee: 1,
    receiptNo: "IBH-10002",
    paymentMethod: "Cash",
    recipient: "Ali Faheem",
    logoUrl: HOSTEL_LOGO_URL,
    signatureUrl: "https://i.postimg.cc/YCHw6N3P/IMG-20251006-WA0034-removebg-preview.png",
    stampUrl: ADMIN_STAMP_URL
  }
];

const searchInput = document.getElementById("searchName");
const resultDiv = document.getElementById("searchResult");
const receiptPdf = document.getElementById("receiptForPdf");

searchInput.addEventListener("input", () => {
  const query = searchInput.value.trim().toLowerCase();
  resultDiv.innerHTML = "";

  if (query.length < 2) return;

  const matches = studentsList.filter(s => s.name.toLowerCase().includes(query) || s.roll.toLowerCase().includes(query));

  if (matches.length === 0) {
    resultDiv.innerHTML = `<p>No match found</p>`;
    return;
  }

  matches.forEach(student => {
    const btn = document.createElement("button");
    btn.className = "btn";
    btn.textContent = `Generate Receipt for ${student.name}`;
    btn.onclick = () => generatePDF(student);
    resultDiv.appendChild(btn);
  });
});

function generatePDF(student) {
  const today = new Date().toLocaleDateString("en-GB", { year: "numeric", month: "long", day: "numeric" });

  receiptPdf.innerHTML = `
    <div class="watermark">PAID</div>

    <div style="text-align:center; border-bottom:2px solid #000; padding-bottom:10px;">
      <img src="${student.logoUrl}" alt="Logo" style="height:60px;">
      <h2 style="margin:5px 0 0; font-size:16pt;">The Indus Boys Hostel Services, Sukkur</h2>
      <div style="font-size:12pt; color:#475569;">Resident Fee Receipt</div>
    </div>

    <div style="margin-top:20px; font-size:10pt; text-align:right;">
      <strong>Receipt No:</strong> ${student.receiptNo}<br>
      <strong>Date:</strong> ${today}
    </div>

    <div class="section-title">üè† Resident Details</div>
    <div>
      <div class="row"><div>Name:</div><div>${student.name}</div></div>
      <div class="row"><div>Roll No:</div><div>${student.roll}</div></div>
      <div class="row"><div>Room:</div><div>${student.room}</div></div>
    </div>

    <div class="section-title">üí≥ Payment Summary</div>
    <div>
      <div class="row"><div>Payment Method:</div><div>${student.paymentMethod}</div></div>
      <div class="row"><div>Amount Paid:</div><div>PKR ${student.fee.toLocaleString()}</div></div>
      <div class="row"><div>Recipient:</div><div>${student.recipient}</div></div>
    </div>

    <div class="signature-area">
      <div class="stamp-box">
        <img src="${student.stampUrl}" alt="Official Stamp" crossorigin="anonymous" />
        <div class="stamp-slogan">Accounts Department<br>"Your trust, our responsibility"</div>
      </div>

      <div class="signature-box">
        <img src="${student.signatureUrl}" alt="Recipient Signature" crossorigin="anonymous" />
        <div style="font-size:10pt; margin-top:5px;"><strong>${student.recipient}</strong></div>
        <div style="font-size:9pt; color:#475569;">Accounts Admin</div>
      </div>
    </div>

    <div class="pdf-footer">
      <strong>Address:</strong> Banglow #88, 10 Feet Road, Sukkur<br>
      Contact: ${MANAGEMENT_PHONE} | Email: ${MANAGEMENT_EMAIL}<br>
      Thank you for your payment.
    </div>
  `;

  downloadAsPDF(student);
}

async function downloadAsPDF(student) {
  const { jsPDF } = window.jspdf;
  const canvas = await html2canvas(receiptPdf, { scale: 2, useCORS: true });
  const imgData = canvas.toDataURL("image/png");

  const pdf = new jsPDF("p", "mm", "a4");
  const pdfWidth = 210;
  const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

  pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
  pdf.save(`Fee-Receipt-${student.roll}.pdf`);
}
</script>
</body>
</html>
