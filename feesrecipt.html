<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Indus Boys Hostel - Fee Receipt Generator</title>

<link rel="icon" type="image/png" href="https://i.postimg.cc/7CFG4hRp/hostel-logo.png">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
Â  :root{
Â  Â  /* ... (keep the existing color variables) ... */
Â  Â  --bg-primary: #f8fafc;
Â  Â  --bg-secondary: #ffffff;
Â  Â  --bg-tertiary: #f1f5f9;
Â  Â  --text-primary: #0f172a;
Â  Â  --text-secondary: #475569;
Â  Â  --text-muted: #94a3b8;
Â  Â  --accent: #0ea5e9;
Â  Â  --accent-dark: #0284c7;
Â  Â  --accent-light: #7dd3fc;
Â  Â  --success: #10b981;
Â  Â  --danger: #ef4444;
Â  Â  --border-color: #e2e8f0;
Â  Â  --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
Â  }
Â  .dark {
Â  Â  /* ... (keep the existing dark mode variables) ... */
Â  Â  --bg-primary: #0f172a;
Â  Â  --bg-secondary: #1e293b;
Â  Â  --bg-tertiary: #334155;
Â  Â  --text-primary: #f8fafc;
Â  Â  --text-secondary: #e2e8f0;
Â  Â  --border-color: #334155;
Â  Â  --shadow: 0 4px 6px -1px rgb(255 255 255 / 0.05), 0 2px 4px -2px rgb(255 255 255 / 0.05);
Â  }
Â  * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
Â  body { margin: 0; padding: 0; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; }
Â  .app-container { max-width: 500px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; }

Â  /* Header Styles */
Â  .header {
Â  Â  display: flex;
Â  Â  flex-direction: column;
Â  Â  align-items: center;
Â  Â  padding: 20px 16px;
Â  Â  background-color: var(--bg-secondary);
Â  Â  border-bottom: 3px solid var(--accent);
Â  Â  box-shadow: var(--shadow);
Â  }
Â  .header-logo { height: 60px; width: auto; margin-bottom: 10px; }
Â  .header-title { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); }
Â  .header-subtitle { font-size: 1.1rem; font-weight: 600; color: var(--accent); margin-top: 5px; }

Â  /* Content & Card Styles */
Â  .content { padding: 16px; flex-grow: 1; }
Â  .card { background-color: var(--bg-secondary); padding: 16px; border-radius: 12px; margin-bottom: 16px; box-shadow: var(--shadow); }
Â  .card-subtitle { font-size: 0.9rem; color: var(--text-secondary); }
Â  .profile-form-group { margin-bottom: 15px; }
Â  label { display: block; margin-bottom: 5px; font-size: 0.9rem; font-weight: 500; color: var(--text-secondary); }
Â  input[type="text"] {
Â  Â  width: 100%;
Â  Â  padding: 10px 12px;
Â  Â  border: 1px solid var(--border-color);
Â  Â  border-radius: 8px;
Â  Â  background-color: var(--bg-tertiary);
Â  Â  color: var(--text-primary);
Â  Â  transition: border-color 0.2s;
Â  }
Â  input[type="text"]:focus {
Â  Â  border-color: var(--accent);
Â  Â  outline: none;
Â  Â  box-shadow: 0 0 0 2px var(--accent-light);
Â  }
Â Â 
Â  /* Buttons */
Â  .btn { padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: background-color 0.2s, opacity 0.2s; font-size: 0.95rem; display: flex; align-items: center; justify-content: center; gap: 8px; }
Â  .btn-primary { background-color: var(--accent); color: white; box-shadow: 0 2px 5px rgba(14, 165, 233, 0.5); }
Â  .btn-primary:hover { background-color: var(--accent-dark); }
Â  .btn-full { width: 100%; }
Â  .btn-sm { padding: 6px 10px; font-size: 0.85rem; }

Â  /* Receipt Previews (On-Screen) */
Â  .receipt-preview { border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; background: var(--bg-secondary); box-shadow: var(--shadow); margin-top: 16px; }
Â  .receipt-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dotted var(--border-color); }
Â  .receipt-label { color: var(--text-secondary); font-size: 0.9rem; }
Â  .receipt-value { font-weight: 600; color: var(--text-primary); text-align: right; }
Â  .student-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border-color); cursor: pointer; }
Â  .student-item:last-child { border-bottom: none; }
Â  .student-item:hover { background-color: var(--bg-tertiary); margin: 0 -16px; padding: 10px 16px; }

Â  /* PDF Content Styling (Hidden for screen, visible for html2canvas) */
Â  #receiptForPdf { 
        position: fixed; left: -9999px; top: -9999px; 
        width: 210mm; background: white; padding: 20mm; 
        color: #000; font-family: 'Roboto', sans-serif; font-size: 12pt; 
    }
    
Â  .pdf-header { 
        overflow: hidden; /* Use clearfix/overflow for float layout */
        border-bottom: 3px solid #000; padding-bottom: 10px; margin-bottom: 20px; 
    }
Â  .pdf-logo { 
        height: 40px; width: auto; margin-right: 15px; 
        float: left; 
    }
Â  .pdf-company-info {
        float: left;
    }
Â  .pdf-company-info .title { font-size: 18pt; font-weight: 700; }
Â  .pdf-company-info .subtitle { font-size: 10pt; color: #475569; }
Â  .pdf-receipt-meta { 
        text-align: right; font-size: 10pt; 
        float: right;
    }
Â  .pdf-section-title { font-size: 14pt; font-weight: 700; color: #1e293b; margin-top: 25px; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }

Â  /* ğŸ’¡ FIX: Replace grid with floating columns for better PDF render */
Â  .pdf-detail-item {
        width: 48%; /* Almost 50% for two columns */
        float: left; 
        margin-bottom: 15px;
    }
    .pdf-detail-item:nth-child(even) {
        float: right; /* Push every second item to the right */
    }
    .pdf-details-grid {
        overflow: hidden; /* Clearfix for floating items */
        margin-bottom: 10px;
    }
    /* ------------------------------------------------------------- */
    
Â  .pdf-detail-item div { font-size: 9pt; color: #64748b; }
Â  .pdf-detail-item strong { font-size: 11pt; font-weight: 500; display: block; margin-top: 2px; }
Â  .pdf-amount-words { font-style: italic; margin-top: 15px; font-size: 10pt; padding: 5px; border: 1px dashed #ccc; }
Â  
Â  /* ğŸ’¡ FIX: Replace flex with floating sections for signatures */
Â  .pdf-signature-section { 
        overflow: hidden; 
        margin-top: 40px; 
    }
Â  .pdf-signature-box {
        float: left;
        width: 30%; /* Allocate space for the first two items */
        text-align: center;
        margin-right: 5%;
    }
    .pdf-signature-box:last-child {
        margin-right: 0;
    }
    .pdf-notes {
        float: right;
        width: 30%; /* Allocate space for the third item (notes) */
        text-align: right; 
    }
    /* ------------------------------------------------------------- */

Â  .signature-image { max-width: 120px; height: auto; margin-bottom: -10px; display: block; margin-left: auto; margin-right: auto; }
Â  .pdf-signature-name { font-size: 10pt; font-weight: 700; }
Â  .pdf-signature-title { font-size: 9pt; color: #475569; }
Â  .pdf-footer { text-align: center; margin-top: 30px; font-size: 8pt; color: #64748b; }
</style>
</head>
<body>

<div class="app-container">
Â  <header class="header">
Â  Â  <img src="https://i.postimg.cc/7CFG4hRp/hostel-logo.png" alt="Hostel Logo" class="header-logo" />
Â  Â  <div class="header-title">The Indus Boys Hostel Services, Sukkur</div>
Â  Â  <div class="header-subtitle">Fee Receipt Generator</div>
Â  </header>

Â  <main class="content">
Â  Â  <section id="view-receipt" class="view">
Â  Â  Â  Â  <h2 class="text-xl font-bold mb-3" style="font-size:1.5rem; margin-bottom:20px;">Generate Hostel Fee Receipt</h2>
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <div class="profile-form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="searchName">Search Resident by Name or Roll No:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="searchName" placeholder="e.g., Awais Mahar or 20K-1000">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="searchResult" class="mt-4">
Â  Â  Â  Â  Â  Â  <div class="card" style="text-align:center; color:var(--text-secondary);">
Â  Â  Â  Â  Â  Â  Â  Â  Start typing to search for a resident's details.
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="receiptPreviewContainer" class="mt-4">
Â  Â  Â  Â  </div>
Â  Â  </section>
Â  </main>
</div>

<div id="receiptForPdf"></div>


<script>
Â  /* ========== CONFIGURATION & DATA ========== */
Â  const DEFAULT_AVATAR_URL = 'https://img.freepik.com/premium-photo/memoji-happy-man-white-background-emoji_826801-6833.jpg?semt=ais_hybrid&w=740&q=80';
Â  const ADMIN_SIGNATURE_URL = 'https://i.postimg.cc/vZztLrMQ/Red-and-White-Minimalist-Christmas-Circle-Sticker-removebg-preview.png';Â 
Â  const HOSTEL_LOGO_URL = 'https://i.postimg.cc/7CFG4hRp/hostel-logo.png';
Â  const MANAGEMENT_PHONE_WA_DISPLAY = '0313-7352949';
Â  const MANAGEMENT_EMAIL = 'indusboyshostelsuk@gmail.com';

Â  // Updated resident data with unique receiptNo, paymentMethod, recipient, and payerSignatureUrl
Â  const newResidents = [
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Awais Mahar', 
Â  Â  Â  Â  room: '1 SF', 
Â  Â  Â  Â  fee: 15000, 
Â  Â  Â  Â  receiptNo: 'IBH-10001', 
Â  Â  Â  Â  paymentMethod: 'Bank Transfer', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-1.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Ali Zaib', 
Â  Â  Â  Â  room: '1 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10002', 
Â  Â  Â  Â  paymentMethod: 'Cash', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-2.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'M Nawaz Awan', 
Â  Â  Â  Â  room: '1 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10003', 
Â  Â  Â  Â  paymentMethod: 'EasyPaisa', 
Â  Â  Â  Â  recipient: 'Admin Account',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-3.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Farooque Rauf', 
Â  Â  Â  Â  room: '2 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10004', 
Â  Â  Â  Â  paymentMethod: 'JazzCash', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-4.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Farooque Bro', 
Â  Â  Â  Â  room: '2 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10005', 
Â  Â  Â  Â  paymentMethod: 'Bank Transfer', 
Â  Â  Â  Â  recipient: 'Admin Account',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-5.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Mubeen', 
Â  Â  Â  Â  room: '2 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10006', 
Â  Â  Â  Â  paymentMethod: 'Cash', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-6.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Jareer Ahmed', 
Â  Â  Â  Â  room: '2 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10007', 
Â  Â  Â  Â  paymentMethod: 'EasyPaisa', 
Â  Â  Â  Â  recipient: 'Admin Account',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-7.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'M Abbas', 
Â  Â  Â  Â  room: '3 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10008', 
Â  Â  Â  Â  paymentMethod: 'Cash', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-8.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Jawad javeed', 
Â  Â  Â  Â  room: '3 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10009', 
Â  Â  Â  Â  paymentMethod: 'Bank Transfer', 
Â  Â  Â  Â  recipient: 'Admin Account',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-9.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Zain Ali', 
Â  Â  Â  Â  room: '3 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10010', 
Â  Â  Â  Â  paymentMethod: 'JazzCash', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-10.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Shan', 
Â  Â  Â  Â  room: '4 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10011', 
Â  Â  Â  Â  paymentMethod: 'Cash', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-11.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Sain . Shan', 
Â  Â  Â  Â  room: '4 SF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10012', 
Â  Â  Â  Â  paymentMethod: 'Bank Transfer', 
Â  Â  Â  Â  recipient: 'Admin Account',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-12.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Sajid Ali', 
Â  Â  Â  Â  room: '1 FF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10013', 
Â  Â  Â  Â  paymentMethod: 'EasyPaisa', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-13.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Dr. Furqan', 
Â  Â  Â  Â  room: '3 FF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10014', 
Â  Â  Â  Â  paymentMethod: 'Cash', 
Â  Â  Â  Â  recipient: 'Admin Account',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-14.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Dr. New', 
Â  Â  Â  Â  room: '3 FF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10015', 
Â  Â  Â  Â  paymentMethod: 'Bank Transfer', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-15.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Jawad Ali', 
Â  Â  Â  Â  room: '3 FF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10016', 
Â  Â  Â  Â  paymentMethod: 'JazzCash', 
Â  Â  Â  Â  recipient: 'Admin Account',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-16.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Ab. Qadir', 
Â  Â  Â  Â  room: '4 FF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10017', 
Â  Â  Â  Â  paymentMethod: 'Cash', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-17.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Basheer Ahmed', 
Â  Â  Â  Â  room: '4 FF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10018', 
Â  Â  Â  Â  paymentMethod: 'EasyPaisa', 
Â  Â  Â  Â  recipient: 'Admin Account',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-18.png'
Â  Â  Â  },
Â  Â  Â  { 
Â  Â  Â  Â  name: 'Zulfiqar Ali', 
Â  Â  Â  Â  room: '4 FF', 
Â  Â  Â  Â  fee: 15000,
Â  Â  Â  Â  receiptNo: 'IBH-10019', 
Â  Â  Â  Â  paymentMethod: 'Bank Transfer', 
Â  Â  Â  Â  recipient: 'Muhammad Ali',
Â  Â  Â  Â  payerSignatureUrl: 'https://i.postimg.cc/d08q3kR2/signature-placeholder-19.png'
Â  Â  Â  }
Â  ];
Â Â 
Â  const studentsList = newResidents.map((student, index) => ({
Â  Â  Â  name: student.name,
Â  Â  Â  roll: `20K-${(1000 + index).toString()}`, // Dummy Roll Number
Â  Â  Â  room: student.room,
Â  Â  Â  email: `${student.name.replace(/\s/g, '.').toLowerCase()}@ibh.com`,
Â  Â  Â  phone: `0300${(1234560 + index).toString()}`,
Â  Â  Â  avatar: DEFAULT_AVATAR_URL,
Â  Â  Â  fee: student.fee,Â 
Â  Â  Â  // Generate a dummy paid date within the last 30 days
Â  Â  Â  paidDate: new Date(new Date() - Math.floor(Math.random() * 30) * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
Â  Â  Â  // NEW FIELDS MAPPED
Â  Â  Â  receiptNo: student.receiptNo, 
Â  Â  Â  paymentMethod: student.paymentMethod,
Â  Â  Â  recipient: student.recipient,
Â  Â  Â  payerSignatureUrl: student.payerSignatureUrl,
Â  }));

Â  /* ========== DOM ELEMENTS ========== */
Â  const elements = {
Â  Â  searchName: document.getElementById('searchName'),
Â  Â  searchResult: document.getElementById('searchResult'),
Â  Â  receiptPreviewContainer: document.getElementById('receiptPreviewContainer'),
Â  Â  receiptForPdf: document.getElementById('receiptForPdf'),
Â  };

Â  /* ========== UTILITY FUNCTIONS ========== */

Â  function showToast(message, type = 'info', duration = 3000) {
Â  Â  const existingToast = document.querySelector('.toast');
Â  Â  if (existingToast) existingToast.remove();

Â  Â  const toast = document.createElement('div');
Â  Â  toast.className = `toast toast-${type}`;
Â  Â  toast.textContent = message;
Â  Â Â 
Â  Â  // Minimal toast styles for this page
Â  Â  toast.style.cssText = `
Â  Â  Â  Â  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 10px 20px;Â 
Â  Â  Â  Â  border-radius: 8px; color: white; font-weight: 500; z-index: 40; opacity: 0;Â 
Â  Â  Â  Â  transition: opacity 0.3s; background-color: var(--accent);
Â  Â  `;
Â  Â  if (type === 'success') toast.style.backgroundColor = 'var(--success)';
Â  Â  if (type === 'danger') toast.style.backgroundColor = 'var(--danger)';

Â  Â  document.body.appendChild(toast);
Â  Â  setTimeout(() => { toast.style.opacity = '1'; }, 10);
Â  Â  setTimeout(() => { toast.style.opacity = '0'; toast.addEventListener('transitionend', () => toast.remove()); }, duration);
Â  }


Â  /* ========== RECEIPT LOGIC ========== */

Â  function searchStudent() {
Â  Â  const query = elements.searchName.value.trim().toLowerCase();
Â  Â  if (query.length < 2) {
Â  Â  Â  elements.searchResult.innerHTML = `
Â  Â  Â  Â  <div class="card" style="text-align:center; color:var(--text-secondary);">
Â  Â  Â  Â  Â  Â  Start typing to search for a resident's details.
Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  elements.receiptPreviewContainer.innerHTML = '';
Â  Â  Â  return;
Â  Â  }

Â  Â  const filteredStudents = studentsList.filter(s =>
Â  Â  Â  s.name.toLowerCase().includes(query) || s.roll.toLowerCase().includes(query)
Â  Â  );

Â  Â  elements.searchResult.innerHTML = filteredStudents.length > 0 ?
Â  Â  Â  `
Â  Â  Â  <div class="card" style="margin-bottom:12px;">
Â  Â  Â  Â  <div class="card-subtitle">${filteredStudents.length} result(s) found. Tap a student to generate receipt.</div>
Â  Â  Â  </div>
Â  Â  Â  ` :
Â  Â  Â  `<div class="card" style="text-align:center;">No students found matching "${query}"</div>`;

Â  Â  elements.receiptPreviewContainer.innerHTML = ''; // Clear preview on new search

Â  Â  if (filteredStudents.length > 0) {
Â  Â  Â  const listHtml = filteredStudents.map(student => `
Â  Â  Â  Â  <div class="student-item" data-roll="${student.roll}" role="button" tabindex="0">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <div class="student-name">${student.name}</div>
Â  Â  Â  Â  Â  Â  <div class="student-roll">Roll: ${student.roll} | Room: ${student.room}</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button class="btn btn-primary btn-sm generate-receipt-btn">Generate</button>
Â  Â  Â  Â  </div>
Â  Â  Â  `).join('');

Â  Â  Â  const studentListCard = document.createElement('div');
Â  Â  Â  studentListCard.className = 'card';
Â  Â  Â  studentListCard.innerHTML = listHtml;
Â  Â  Â  elements.searchResult.appendChild(studentListCard);

Â  Â  Â  // Add click listeners to the dynamically generated buttons
Â  Â  Â  studentListCard.querySelectorAll('.generate-receipt-btn').forEach(btn => {
Â  Â  Â  Â  btn.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  // Find the roll number from the parent div
Â  Â  Â  Â  Â  const roll = e.currentTarget.closest('.student-item').dataset.roll;
Â  Â  Â  Â  Â  const student = studentsList.find(s => s.roll === roll);
Â  Â  Â  Â  Â  if (student) {
Â  Â  Â  Â  Â  Â  renderReceiptPreview(student);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }
Â  }

Â  function renderReceiptPreview(student) {
Â  Â  const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
Â  Â  const paidDate = student.paidDate ? new Date(student.paidDate).toLocaleDateString() : 'N/A';
Â  Â  const amount = student.fee ? student.fee.toLocaleString() : 'N/A';
Â  Â  const receiptNo = student.receiptNo || `IBH-N/A`;
Â  Â Â 
Â  Â  elements.receiptPreviewContainer.innerHTML = `
Â  Â  Â  <div class="receipt-preview">
Â  Â  Â  Â  <div style="text-align:center; border-bottom:1px solid var(--border-color); padding-bottom:10px; margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  <div style="font-size:1.1rem; font-weight:600; color:var(--accent);">Receipt Preview</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  <div class="receipt-label">Receipt Number</div>
Â  Â  Â  Â  Â  <div class="receipt-value">${receiptNo}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  <div class="receipt-label">Student Name</div>
Â  Â  Â  Â  Â  <div class="receipt-value">${student.name}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  <div class="receipt-label">Roll Number</div>
Â  Â  Â  Â  Â  <div class="receipt-value">${student.roll}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  <div class="receipt-label">Room Number</div>
Â  Â  Â  Â  Â  <div class="receipt-value">${student.room}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  <div class="receipt-label">Amount Received (PKR)</div>
Â  Â  Â  Â  Â  <div class="receipt-value">PKR ${amount}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  <div class="receipt-label">Payment Method</div>
Â  Â  Â  Â  Â  <div class="receipt-value">${student.paymentMethod || 'N/A'}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  <div class="receipt-label">Paid To</div>
Â  Â  Â  Â  Â  <div class="receipt-value">${student.recipient || 'N/A'}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  <div class="receipt-label">Paid For</div>
Â  Â  Â  Â  Â  <div class="receipt-value">Monthly Hostel Fee</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  <div class="receipt-label">Date of Payment</div>
Â  Â  Â  Â  Â  <div class="receipt-value">${paidDate}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="receipt-row" style="border-bottom:none;">
Â  Â  Â  Â  Â  <div class="receipt-label">Date of Generation</div>
Â  Â  Â  Â  Â  <div class="receipt-value">${today}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <button class="btn btn-primary btn-full" id="downloadReceiptBtn" style="margin-top:16px;">â¬‡ï¸ Download Receipt (PDF)</button>
Â  Â  `;

Â  Â  // Add event listener to the newly rendered download button
Â  Â  document.getElementById('downloadReceiptBtn').addEventListener('click', () => downloadReceipt(student));
Â  }

Â  function renderReceiptForPdf(student) {
Â  Â  const paidDate = student.paidDate ? new Date(student.paidDate).toLocaleDateString() : 'N/A';
Â  Â  const amount = student.fee ? student.fee.toLocaleString() : 'N/A';
Â  Â  const receiptNo = student.receiptNo || `IBH-N/A`;
Â  Â  const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

Â  Â  function numberToWords(n) {
Â  Â  Â  Â  if (n === 'N/A') return 'Amount Not Available';
Â  Â  Â  Â  const num = Number(n);
Â  Â  Â  Â  // Extremely simplified conversion
Â  Â  Â  Â  return `Rupees ${num.toLocaleString()} Only`;
Â  Â  }
Â  Â Â 
Â  Â  elements.receiptForPdf.innerHTML = `
Â  Â  Â  <div class="pdf-header">
Â  Â  Â  Â  <div style="display: flex; align-items: center;">
Â  Â  Â  Â  Â  Â  <img src="${HOSTEL_LOGO_URL}" alt="Hostel Logo" class="pdf-logo" crossorigin="anonymous" />
Â  Â  Â  Â  Â  Â  <div class="pdf-company-info">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="title">The Indus Boys Hostel Services, Sukkur</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="subtitle">Resident Fee Receipt</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="pdf-receipt-meta">
Â  Â  Â  Â  Â  Â  <div><strong>Receipt No:</strong> ${receiptNo}</div>
Â  Â  Â  Â  Â  Â  <div><strong>Date:</strong> ${today}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="pdf-section-title">Recipient Details</div>
Â  Â  Â  <div class="pdf-details-grid">
Â  Â  Â  Â  Â  <div class="pdf-detail-item">
Â  Â  Â  Â  Â  Â  Â  <div>Student Name</div>
Â  Â  Â  Â  Â  Â  Â  <strong>${student.name}</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="pdf-detail-item">
Â  Â  Â  Â  Â  Â  Â  <div>Roll Number</div>
Â  Â  Â  Â  Â  Â  Â  <strong>${student.roll}</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="pdf-detail-item">
Â  Â  Â  Â  Â  Â  Â  <div>Room Number</div>
Â  Â  Â  Â  Â  Â  Â  <strong>${student.room}</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="pdf-detail-item">
Â  Â  Â  Â  Â  Â  Â  <div>Contact Phone</div>
Â  Â  Â  Â  Â  Â  Â  <strong>${student.phone || 'N/A'}</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="pdf-section-title">Payment Summary</div>
Â  Â  Â  <div class="pdf-details-grid">
Â  Â  Â  Â  Â  <div class="pdf-detail-item">
Â  Â  Â  Â  Â  Â  Â  <div>Fee Type</div>
Â  Â  Â  Â  Â  Â  Â  <strong>Monthly Hostel Fee</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="pdf-detail-item">
Â  Â  Â  Â  Â  Â  Â  <div>Amount Paid (PKR)</div>
Â  Â  Â  Â  Â  Â  Â  <strong style="font-size: 16px;">PKR ${amount}</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="pdf-detail-item">
Â  Â  Â  Â  Â  Â  Â  <div>Payment Date</div>
Â  Â  Â  Â  Â  Â  Â  <strong>${paidDate}</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="pdf-detail-item">
Â  Â  Â  Â  Â  Â  Â  <div>Payment Method</div>
Â  Â  Â  Â  Â  Â  Â  <strong>${student.paymentMethod || 'N/A'}</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="pdf-detail-item">
Â  Â  Â  Â  Â  Â  Â  <div>Recipient Name</div>
Â  Â  Â  Â  Â  Â  Â  <strong>${student.recipient || 'N/A'}</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="pdf-amount-words">
Â  Â  Â  Â  Â  Amount in Words: ${numberToWords(student.fee)}
Â  Â  Â  </div>
// ... inside renderReceiptForPdf(student)

Â  Â  Â  <div class="pdf-signature-section">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pdf-signature-box">
Â  Â  Â  Â  Â  Â  Â  ${student.payerSignatureUrl ? `<img src="${student.payerSignatureUrl}" alt="Payer Signature" class="signature-image" crossorigin="anonymous" />` : ''}
Â  Â  Â  Â  Â  Â  Â  <div class="pdf-signature-name">${student.name}</div>
Â  Â  Â  Â  Â  Â  Â  <div class="pdf-signature-title">Resident's Signature</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pdf-signature-box" style="margin-left: 5%; margin-right: 5%;">
Â  Â  Â  Â  Â  Â  Â  <img src="${ADMIN_SIGNATURE_URL}" alt="Authorized Signature" class="signature-image" crossorigin="anonymous" />
Â  Â  Â  Â  Â  Â  Â  <div class="pdf-signature-name">Accounts Department</div>
Â  Â  Â  Â  Â  Â  Â  <div class="pdf-signature-title">Authorized Signature (Paid To)</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pdf-notes">
Â  Â  Â  Â  Â  Â  Â  <strong>Hostel Address:</strong>
Â  Â  Â  Â  Â  Â  Â  Banglow #88, 10 Feet Road, Sukkur<br>
Â  Â  Â  Â  Â  Â  Â  Contact: ${MANAGEMENT_PHONE_WA_DISPLAY}<br>
Â  Â  Â  Â  Â  Â  Â  Email: ${MANAGEMENT_EMAIL}
Â  Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="pdf-footer">
Â  Â  Â  Â  Â  Thank you for being a resident at The Indus Boys Hostel Services, Sukkur.
Â  Â  Â  </div>
Â  Â  `;

Â  Â  // Make the hidden div accessible for html2canvas
Â  Â  elements.receiptForPdf.style.left = '0';
Â  Â  elements.receiptForPdf.style.top = '0';
Â  Â  elements.receiptForPdf.style.position = 'absolute';
Â  }


Â  async function downloadReceipt(student) {
Â  Â  showToast(`Generating receipt for ${student.name}...`, 'info');

Â  Â  // 1. Prepare data for PDF
Â  Â  renderReceiptForPdf(student);Â 

Â  Â  // 2. Capture the hidden content
Â  Â  const input = elements.receiptForPdf;

Â  Â  try {
Â  Â  Â  // Use html2canvas
Â  Â  Â  const canvas = await html2canvas(input, {Â 
Â  Â  Â  Â  Â  scale: 2,
Â  Â  Â  Â  Â  useCORS: trueÂ 
Â  Â  Â  });
Â  Â  Â  const imgData = canvas.toDataURL('image/png');

Â  Â  Â  // Use jsPDF from the UMD global window object
Â  Â  Â  const { jsPDF } = window.jspdf;Â 

Â  Â  Â  const pdf = new jsPDF('p', 'mm', 'a4');
Â  Â  Â  const pdfWidth = 210;Â 
Â  Â  Â  const imgProps = pdf.getImageProperties(imgData);
Â  Â  Â Â 
Â  Â  Â  const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

Â  Â  Â  pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
Â  Â  Â  pdf.save(`receipt-${student.roll}-${new Date().toLocaleDateString().replace(/\//g, '-')}.pdf`);

Â  Â  Â  showToast('Receipt downloaded successfully!', 'success');
Â  Â  Â Â 
Â  Â  } catch (error) {
Â  Â  Â  console.error('Error generating PDF:', error);
Â  Â  Â  showToast('Error generating receipt. See console for details.', 'danger');
Â  Â  } finally {
Â  Â  Â  // Hide the temporary PDF content again
Â  Â  Â  elements.receiptForPdf.style.left = '-9999px';
Â  Â  Â  elements.receiptForPdf.style.top = '-9999px';
Â  Â  Â  elements.receiptForPdf.style.position = 'fixed';
Â  Â  }
Â  }

Â  /* ========== INITIALIZE APP ========== */
Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  // Event Listener for live search
Â  Â  elements.searchName.addEventListener('input', searchStudent);Â 
Â  });
</script>
</body>
</html>
